@model ResponseModel<Project>

@{
	ViewBag.Title = "Index";
	Layout = "~/Areas/Admin/Views/Shared/_Layout_Admin.cshtml";

	string ProjectId = Model.SelectListItems.Where(x => x.Group == "P").Count() > 1 ? null : Model.SelectListItems.Where(x => x.Group == "P").Select(x => x.Value).FirstOrDefault();
	long Logged_In_CustomerId = 0;
	try { Logged_In_CustomerId = Common.Get_Session_Int(SessionKey.KEY_IS_CUSTOMER) == 1 ? Common.Get_Session_Int(SessionKey.KEY_USER_ID) : 0; } catch { }
	string CustomerId = null;
	try { CustomerId = Model.SelectListItems.Where(x => x.Group == "C").Count() > 1 ? null : Model.SelectListItems.Where(x => x.Group == "C").Select(x => x.Value).FirstOrDefault(); } catch { }
}

@section Styles {
	<style type="text/css">
		.box {
			cursor: pointer;
			background-color: #f15a07;
			color: white;
			padding: 20px;
			border-radius: 20px;
			font-weight: bold;
			min-height: 120px;
			display: flex;
			flex-direction: column;
			justify-content: center;
		}
	</style>
}

<!-- start page title -->
<div class="row">
	<div class="col-12">
		<div class="page-title-box">
			<h4 class="page-title">Project Detail</h4>
		</div>
	</div>
</div>
<!-- end page title -->


<div class="row">
	<div class="col-12">
		<div class="card">
			<div class="card-header">
				<div class="row no-gutters mb-1">
					<div class="col-sm-4 @(Logged_In_CustomerId > 0 ? "d-none":"")">
						<div class="form-group row d-flex align-items-center">
							<label for="ddlCustomer" class="col-sm-3 col-form-label text-end"> Customer </label>
							<div class="col-sm-9">
								<select id="ddlCustomer" name="CustomerId" class="form-control form-control-sm select2"
										data-selected="@CustomerId" onchange="fnChange_GetProjects(this)">
									<option value="0">-- Select --</option>
									@if (Model.SelectListItems != null)
									{
										foreach (var item in Model.SelectListItems.Where(x => x.Group == "C"))
										{
											if (CustomerId == item.Value)
											{
												<option value="@item.Value" selected>@item.Text</option>
											}
											else
											{
												<option value="@item.Value">@item.Text</option>
											}
										}
									}
								</select>
							</div>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group row d-flex align-items-center">
							<label for="ddlProject" class="col-sm-1 col-form-label text-end"> Project </label>
							<div class="col-sm-10">
								<select id="ddlProject" name="ProjectId" class="form-control form-control-sm select2"
										onchange="fnChange_GetProjectDetails(this)">
									<option value="0">-- Select --</option>
									@if (Model.SelectListItems != null)
									{
										foreach (var item in Model.SelectListItems.Where(x => x.Group == "P"))
										{
											if (ProjectId == item.Value)
											{
												<option value="@item.Value" selected>@item.Text</option>
											}
											else
											{
												<option value="@item.Value">@item.Text</option>
											}
										}
									}
								</select>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="card-body">
				<div class="row no-gutters" id="divProjectDetail">
					<h4 class="header-title">Project Detail</h4>
					<div class="col-md-6 my-1">
						<dl class="row mb-0">

							<dt class="col-sm-3 text-end">Project Name : </dt>
							<dd class="col-sm-9" id="ProjectName"></dd>

							<dt class="col-sm-3 text-end">Description : </dt>
							<dd class="col-sm-9" id="Description"> </dd>

							<dt class="col-sm-3 text-end">Start Date : </dt>
							<dd class="col-sm-9" id="StartDate"></dd>

							<dt class="col-sm-3 text-end">Handover Date : </dt>
							<dd class="col-sm-9" id="HandoverDate"></dd>

							<dt class="col-sm-3 text-end">Address : </dt>
							<dd class="col-sm-9" id="Address"> </dd>

						</dl>
					</div>

					<div class="col-md-6 my-1">
						<dl class="row mb-0">
							<dt class="col-sm-3 text-end">Coordinator : </dt>
							<dd class="col-sm-9" id="Coordinator"></dd>

							<dt class="col-sm-3 text-end">Site Detail : </dt>
							<dd class="col-sm-9" id="SiteDetail"> </dd>

							<dt class="col-sm-3 text-end">Status : </dt>
							<dd class="col-sm-9" id="Status"></dd>

							<dt class="col-sm-3 text-end">&nbsp;</dt>
							<dd class="col-sm-9">&nbsp;</dd>

							<dt class="col-sm-3 text-end">Location Link : </dt>
							<dd class="col-sm-9" id="LocationLink">&nbsp;</dd>
						</dl>
					</div>

					<div class="clearfix"></div>
				</div>

				<div class="row no-gutters m-5 px-5" id="divProjectSiteDoc" style="display:none">
					<div class="card border-primary border">
						<div class="card-body">
							<div class="d-flex align-items-start justify-content-between">
								<div class="d-flex">
									<h5 class="card-title text-primary">Special title treatment</h5>
								</div>
								<div class="">
									<button role="button" class="btn btn-danger btn-sm" onclick="fnClose_ProjectSiteDoc()"> <i class="ri-close-fill"></i> </button>
								</div>
							</div>
							<form id="formProjectSiteDoc" class="form-horizontal">
								<input type="text" class="form-control d-none" id="Type" name="Type">
								<div class="row mb-3">
									<label for="UploadDate_Text" class="col-2 col-form-label text-end">Upload Date</label>
									<div class="col-2">
										<input type="date" name="UploadDate_Text" class="form-control"
											   data-value="@(DateTime.Now.Date.ToString("yyyy-MM-dd"))">
									</div>
								</div>
								<div class="row mb-3">
									<label for="UploadFile" class="col-2 col-form-label text-end">Upload File</label>
									<div class="col-6">
										<span class="control-fileupload">
											<input type="file" id="UploadFile" accept="image/png, image/gif, image/jpeg, application/pdf" class="form-control">
										</span>
									</div>
									<div class="col-2">
										<button type="button" class="btn btn-info"><i class="ri-file-download-fill me-1"></i> <span> View</span> </button>
									</div>
								</div>
								<div class="row mb-3">
									<label for="Remark" class="col-2 col-form-label text-end">Remarks</label>
									<div class="col-9">
										<input type="text" class="form-control" id="Remark">
									</div>
								</div>
								<div class="justify-content-end row">
									<div class="col-10">
										<button type="submit" class="btn btn-info">Save</button>
									</div>
								</div>
							</form>

							<div class="table-responsive-sm mt-3" id="divProjectSiteDocList">
								<table class="table table-bordered table-centered mb-0">
									<thead>
										<tr>
											<th>Upload Date</th>
											<th>Upload File</th>
											<th>Remarks</th>
											<th class="text-center">Action</th>
										</tr>
									</thead>
									<tbody> </tbody>
								</table>
							</div>
						</div> <!-- end card-body-->
					</div>
				</div>

				<div class="row d-flex align-items-center justify-content-center mt-4" id="divProjectDetailOption" style="display:none">
					<div class="col-10">
						<div class="container py-5">
							<div class="row g-4">
								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="EPM">
										<p class="mb-1">Estimate</p>
										<p class="mb-1">Payment Terms</p>
										<p class="mb-0">Material Specifications</p>
									</div>
								</div>

								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="F3D">FINAL 3D</div>
								</div>

								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="DRW">DRAWINGS</div>
								</div>

								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="WCLTSC">CLIENT SCOPE OF WORK</div>
								</div>

								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="MB">MOOD BOARD</div>
								</div>

								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="SITE">SITE UPDATES</div>
								</div>

								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="WPEND">PENDING SELECTION & WORK</div>
								</div>

								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="MPRO">MATERIAL PROCUREMENT</div>
								</div>

								<div class="col-md-4">
									<div class="box text-center d-flex align-items-center justify-content-center" data-type="WCOMP">WORK COMPLITION REPORT</div>
								</div>

							</div>
						</div>
					</div>
				</div>

			</div> <!-- end card body-->
		</div> <!-- end card -->
	</div><!-- end col-->
</div> <!-- end row-->
@section Scripts {
	<script type="text/javascript">
		$(document).ready(function () {

			$('#divProjectDetailOption').css('display', 'none');
			$('#divProjectSiteDoc').css('display', 'none');

			let change = '@(Logged_In_CustomerId > 0 ? "1" : "")'

			if (typeof change != 'undefined' && change != null && change != '' && !isNaN(parseInt(change)) && parseInt(change) > 0)
				$("#ddlProject").trigger('change');

			$('.box').on('click', function () {
				debugger;
				ShowLoader(true);
				$('#divProjectSiteDoc').css('display', 'none');

				const _this = $(this);

				setTimeout(function () {

					var CustomerId = $('#ddlCustomer option:selected').val();
					if ((typeof CustomerId != 'undefined' && CustomerId != null && CustomerId != '' && !isNaN(parseInt(CustomerId)) && parseInt(CustomerId) > 0)
						|| (typeof change != 'undefined' && change != null && change != '' && !isNaN(parseInt(change)) && parseInt(change) > 0)) {
						var ProjectId = $('#ddlProject option:selected').val();

						if (typeof ProjectId != 'undefined' && ProjectId != null && ProjectId != '' && !isNaN(parseInt(ProjectId)) && parseInt(ProjectId) > 0) { }
						else { CommonAlert_Error('Please select Project', null); return false; }
					}
					else { CommonAlert_Error('Please select Customer', null); return false; }

					const boxType = _this.attr('data-type').trim();

					$('#divProjectDetailOption').css('display', 'none');
					$('#divProjectSiteDoc').css('display', 'block');

					var title = 'Estimate Payment Terms Material Specifications List (Customer)';

					if (boxType == 'EPM') title = 'Estimate Payment Terms Material Specifications List (Customer)';
					else if (boxType == 'F3D') title = 'FINAL 3D';
					else if (boxType == 'DRW') title = 'DRAWINGS';
					else if (boxType == 'WCLTSC') title = 'CLIENT SCOPE OF WORK';
					else if (boxType == 'MB') title = 'MOOD BOARD';
					else if (boxType == 'SITE') title = 'SITE UPDATES';
					else if (boxType == 'WPEND') title = 'PENDING SELECTION & WORK';
					else if (boxType == 'MPRO') title = 'MATERIAL PROCUREMENT';
					else if (boxType == 'WCOMP') title = 'WORK COMPLITION REPORT';

					$('#divProjectSiteDoc .card-title').text(title);
					$('#divProjectSiteDoc form input#Type').val(boxType).trigger('change');

					debugger;
					$('#divProjectSiteDoc input[type="date"]').val($('#divProjectSiteDoc input[type="date"]').attr('data-value')).trigger('change');

					// Optional: add navigation logic here
					// Example: window.location.href = boxType.toLowerCase().replace(/\s+/g, '-') + '.html';

					ShowLoader(false);
				}, 1000);
			});

		});

		function fnClose_ProjectSiteDoc() {
			$('#divProjectSiteDoc form input').val(null).trigger('change');
			$('#divProjectDetailOption').css('display', 'block');
			$('#divProjectSiteDoc').css('display', 'none');
		}

		function fnChange_GetProjects($this) {

			$('#divProjectDetail dd').text('');
			$('#divProjectDetailOption').css('display', 'none');
			$('#divProjectSiteDoc').css('display', 'none');

			var CustomerId = $($this).find('option:selected').val();

			if (typeof CustomerId != 'undefined' && CustomerId != null && CustomerId != '' && !isNaN(parseInt(CustomerId)) && parseInt(CustomerId) > 0) {

				var ddlProject = $("#ddlProject");
				ddlProject.empty();
				ddlProject.append('<option value="0">-- Select --</option>');

				ShowLoader(true);
				$.ajax({
					type: "POST",
					url: "@Url.Action("GetProjectByCustomerId", "Project", new { area = "Admin" })?CustomerId=" + CustomerId,
					data: {},
					cache: false,
					contentType: false,
					processData: false,
					dataType: "json",
					success: function (response) {
						ShowLoader(false);

						if (response != null && response.length > 0) {
							$.each(response, function () {
								ddlProject.append($("<option></option>").val(this['Value']).html(this['Text']));
							});
						}

						$("#ddlProject").trigger('change');
						$("#ddlProject").select2();
					},
					failure: function (xhr) {
						ShowLoader(false);
						console.log('error : ' + xhr.status + ' - ' + xhr.statusText + ' - ' + xhr.responseText);
					},
					error: function (xhr) {
						ShowLoader(false);
						console.log('error : ' + xhr.status + ' - ' + xhr.statusText + ' - ' + xhr.responseText);
					}
				});
			}
		}

		function fnChange_GetProjectDetails($this) {

			$('#divProjectDetail dd').text('');
			$('#divProjectDetailOption').css('display', 'none');
			$('#divProjectSiteDoc').css('display', 'none');

			var CustomerId = $('#ddlCustomer option:selected').val();
			var ProjectId = $($this).find('option:selected').val();

			if (typeof ProjectId != 'undefined' && ProjectId != null && ProjectId != '' && !isNaN(parseInt(ProjectId)) && parseInt(ProjectId) > 0) {

				ShowLoader(true);
				$.ajax({
					type: "POST",
					url: "@Url.Action("GetProjectDetail", "Project", new { area = "Admin" })?CustomerId=" + CustomerId + "&ProjectId=" + ProjectId,
					data: {},
					cache: false,
					contentType: false,
					processData: false,
					dataType: "json",
					success: function (response) {
						ShowLoader(false);
						//debugger;
						if (response != null) {

							$('#ProjectName').text(response['Name']);
							$('#Description').text(response['Description']);
							$('#StartDate').text(response['StartDate_Text']);
							$('#HandoverDate').text(response['HandoverDate_Text']);
							$('#Address').text(response['Address']);

							$('#Coordinator').text(response['CoordinatorName']);
							$('#SiteDetail').text(response['SiteDetail']);
							$('#Status').text((response['IsActive'] == true ? 'Active' : 'Inactive'));
							$('#LocationLink').text(response['LocationLink']);

							$('#divProjectDetailOption').css('display', 'block');
						}
					},
					failure: function (xhr) {
						ShowLoader(false);
						console.log('error : ' + xhr.status + ' - ' + xhr.statusText + ' - ' + xhr.responseText);
					},
					error: function (xhr) {
						ShowLoader(false);
						console.log('error : ' + xhr.status + ' - ' + xhr.statusText + ' - ' + xhr.responseText);
					}
				});
			}

		}

	</script>
}